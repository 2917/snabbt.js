/*! snabbt.js v0.4.0 built: 2015-02-23  (c)2015 Daniel Lundin @license MIT */
!function(a,b){var c=b();"object"==typeof exports?module.exports=c:"function"==typeof define&&define.amd?define([],function(){return a.returnExportsGlobal=c}):a.snabbt=c}(this,function(){var a=[],b=[],c=[];snabbt=function(a,b,c){var f=a;if(void 0!==f.length){for(var g={chainers:[],then:function(a){var b=this.chainers.length;return this.chainers.forEach(function(c,e){c.then(d(a,e,b))}),g},setValue:function(a){return this.chainers.forEach(function(b){b.setValue(a)}),g},finish:function(){return this.chainers.forEach(function(a){a.finish()}),g},rollback:function(){return this.chainers.forEach(function(a){a.rollback()}),g}},h=0,i=f.length;i>h;++h)g.chainers.push("string"==typeof b?e(f[h],b,d(c,h,i)):e(f[h],d(b,h,i),c));return g}return"string"==typeof b?e(f,b,d(c,0,1)):e(f,d(b,0,1),c)};var d=function(a,b,c){if(!a)return a;var d=Q(a);P(a.delay)&&(d.delay=a.delay(b,c)),P(a.callback)&&(d.callback=function(){a.callback(b,c)}),P(a.valueFeeder)&&(d.valueFeeder=function(d,e){return a.valueFeeder(d,e,b,c)}),P(a.easing)&&(d.easing=function(d){return a.easing(d,b,c)});var e=["position","rotation","skew","rotationPost","scale","width","height","opacity","fromPosition","fromRotation","fromSkew","fromRotationPost","fromScale","fromWidth","fromHeight","fromOpacity","transformOrigin","duration","delay"];return e.forEach(function(e){P(a[e])&&(d[e]=a[e](b,c))}),d},e=function(a,c,e){function h(c){return u.tick(c),u.updateElement(a),u.isStopped()?void 0:u.completed()?void(j.loop>1&&!u.isStopped()?(j.loop-=1,u.restart(),n(h)):(j.callback&&j.callback(a),v.length&&(j=v.pop(),q=l(j,s,!0),s=l(j,Q(s)),j=m(q,s,j),u=new p(j),b.push([a,u]),u.tick(c),n(h)))):n(h)}if("attention"===c)return f(a,e);if("stop"===c)return g(a);var j=c;i();var o=k(a),q=o;q=l(j,q,!0);var s=Q(o);s=l(j,s);var t=m(q,s,j),u=r(t);b.push([a,u]),u.updateElement(a);var v=[],w={then:function(a){return v.unshift(d(a,0,1)),w}};return n(h),j.manual?u:w},f=function(a,c){function d(b){f.tick(b),f.updateElement(a),f.completed()?(c.callback&&c.callback(a),c.loop&&c.loop>1&&(c.loop--,f.restart(),n(d))):n(d)}var e=l(c);c.movement=e;var f=new q(c);b.push([a,f]),n(d)},g=function(a){for(var c=0,d=b.length;d>c;++c){var e=b[c],f=e[0],g=e[1];f===a&&g.stop()}},h=function(a,b){for(var c=0,d=a.length;d>c;++c){var e=a[c],f=e[0],g=e[1];if(f===b){var h=g.getCurrentState();return g.stop(),h}}},i=function(){c=c.filter(function(a){return j(a[0]).body})},j=function(a){for(var b=a;b.parentNode;)b=b.parentNode;return b},k=function(a){var d=h(b,a);return d?d:h(c,a)},l=function(a,b,c){b||(b=new K({}));var d="position",e="rotation",f="skew",g="rotationPost",h="scale",i="width",j="height",k="opacity";return c&&(d="fromPosition",e="fromRotation",f="fromSkew",g="fromRotationPost",h="fromScale",i="fromWidth",j="fromHeight",k="fromOpacity"),b.position=M(a[d],b.position),b.rotation=M(a[e],b.rotation),b.rotationPost=M(a[g],b.rotationPost),b.skew=M(a[f],b.skew),b.scale=M(a[h],b.scale),b.opacity=a[k],b.width=a[i],b.height=a[j],b},m=function(a,b,c){return c.startState=a,c.endState=b,c},n=function(b){0===a.length&&window.requestAnimationFrame(o),a.push(b)},o=function(d){for(var e=a.length,f=0;e>f;++f)a[f](d);a.splice(0,e);var g=b.filter(function(a){return a[1].completed()});c=c.filter(function(a){for(var b=0,c=g.length;c>b;++b)if(a[0]===g[b][0])return!1;return!0}),c=c.concat(g),b=b.filter(function(a){return!a[1].completed()}),0!==a.length&&window.requestAnimationFrame(o)},p=function(a){this.startState=a.startState,this.endState=a.endState,this.duration=M(a.duration,500),this.delay=M(a.delay,0),this.perspective=a.perspective,this.easing=z(M(a.easing,"linear"),a),this.currentState=this.startState.clone(),this.transformOrigin=a.transformOrigin,this.currentState.transformOrigin=a.transformOrigin,this.startTime=0,this.currentTime=0,this.stopped=!1,this.manual=a.manual,this.manualValue=0,this.manualDelayFactor=this.delay/this.duration,this.tweener=a.valueFeeder?new L(a.valueFeeder,this.startState,this.endState,this.currentState):new StateTweener(this.startState,this.endState,this.currentState)};p.prototype.stop=function(){this.stopped=!0},p.prototype.isStopped=function(){return this.stopped},p.prototype.finish=function(a){this.manual=!1;var b=this.duration*this.manualValue;this.startTime=this.currentTime-b,this.manualCallback=a,this.easing.resetFrom=this.manualValue},p.prototype.rollback=function(a){this.manual=!1,this.tweener.setReverse();var b=this.duration*(1-this.manualValue);this.startTime=this.currentTime-b,this.manualCallback=a,this.easing.resetFrom=this.manualValue},p.prototype.restart=function(){this.startTime=void 0,this.easing.resetFrom(0)},p.prototype.tick=function(a){if(!this.stopped){if(this.manual)return this.currentTime=a,void this.updateCurrentTransform();this.startTime||(this.startTime=a),a-this.startTime>this.delay&&(this.currentTime=a-this.delay);var b=Math.min(Math.max(0,this.currentTime-this.startTime),this.duration);this.easing.tick(b/this.duration),this.updateCurrentTransform(),this.completed()&&this.manualCallback&&this.manualCallback()}},p.prototype.getCurrentState=function(){return this.currentState},p.prototype.setValue=function(a){this.manualValue=Math.min(Math.max(a,1e-4),1+this.manualDelayFactor)},p.prototype.updateCurrentTransform=function(){var a=this.easing.value();this.manual&&(a=Math.max(1e-5,this.manualValue-this.manualDelayFactor)),this.tweener.tween(a)},p.prototype.completed=function(){return this.stopped?!0:0===this.startTime?!1:this.easing.completed()},p.prototype.updateElement=function(a){var b=this.tweener.asMatrix(),c=this.tweener.getProperties();N(a,b,this.perspective),O(a,c)};var q=function(a){this.movement=a.movement,this.currentMovement=new K({}),a.initialVelocity=.1,a.equilibriumPosition=0,this.spring=new w(a),this.stopped=!1,this.options=a};q.prototype.stop=function(){this.stopped=!0},q.prototype.isStopped=function(){return this.stopped},q.prototype.tick=function(){this.stopped||this.spring.equilibrium||(this.spring.tick(),this.updateMovement())},q.prototype.updateMovement=function(){var a=this.currentMovement,b=this.movement,c=this.spring.position;a.position[0]=b.position[0]*c,a.position[1]=b.position[1]*c,a.position[2]=b.position[2]*c,a.rotation[0]=b.rotation[0]*c,a.rotation[1]=b.rotation[1]*c,a.rotation[2]=b.rotation[2]*c,a.rotationPost[0]=b.rotationPost[0]*c,a.rotationPost[1]=b.rotationPost[1]*c,a.rotationPost[2]=b.rotationPost[2]*c,1!==b.scale[0]&&1!==b.scale[1]&&(a.scale[0]=1+b.scale[0]*c,a.scale[1]=1+b.scale[1]*c),a.skew[0]=b.skew[0]*c,a.skew[1]=b.skew[1]*c},q.prototype.updateElement=function(a){N(a,this.currentMovement.asMatrix()),O(a,this.currentMovement.getProperties())},q.prototype.getCurrentState=function(){return this.currentMovement},q.prototype.completed=function(){return this.spring.equilibrium||this.stopped},q.prototype.restart=function(){this.spring=new w(this.options)};var r=function(a){return new p(a)},s=function(a){return a},t=function(a){return(Math.cos(a*Math.PI+Math.PI)+1)/2},u=function(a){return a*a},v=function(a){return-Math.pow(a-1,2)+1},w=function(a){this.position=M(a.startPosition,0),this.equilibriumPosition=M(a.equilibriumPosition,1),this.velocity=M(a.initialVelocity,0),this.springConstant=M(a.springConstant,.8),this.deceleration=M(a.springDeceleration,.9),this.mass=M(a.springMass,10),this.equilibrium=!1};w.prototype.tick=function(a){if(0!==a&&!this.equilibrium){var b=-(this.position-this.equilibriumPosition)*this.springConstant,c=b/this.mass;this.velocity+=c,this.position+=this.velocity,this.velocity*=this.deceleration,Math.abs(this.position-this.equilibriumPosition)<.001&&Math.abs(this.velocity)<.001&&(this.equilibrium=!0)}},w.prototype.resetFrom=function(a){this.position=a,this.velocity=0},w.prototype.value=function(){return this.equilibrium?this.equilibriumPosition:this.position},w.prototype.completed=function(){return this.equilibrium};var x={linear:s,ease:t,easeIn:u,easeOut:v},y=function(a){this.easer=a,this._value=0};y.prototype.tick=function(a){this._value=this.easer(a),this.lastValue=a},y.prototype.resetFrom=function(){this.lastValue=0},y.prototype.value=function(){return this._value},y.prototype.completed=function(){return this.lastValue>=1?this.lastValue:!1};var z=function(a,b){if("spring"==a)return new w(b);var c=a;return P(a)||(c=x[a]),new y(c)},A=function(a,b,c,d){a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=b,a[13]=c,a[14]=d,a[15]=1},B=function(a,b){a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=Math.cos(b),a[6]=-Math.sin(b),a[7]=0,a[8]=0,a[9]=Math.sin(b),a[10]=Math.cos(b),a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},C=function(a,b){a[0]=Math.cos(b),a[1]=0,a[2]=Math.sin(b),a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=-Math.sin(b),a[9]=0,a[10]=Math.cos(b),a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},D=function(a,b){a[0]=Math.cos(b),a[1]=-Math.sin(b),a[2]=0,a[3]=0,a[4]=Math.sin(b),a[5]=Math.cos(b),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},E=function(a,b,c){a[0]=1,a[1]=Math.tan(b),a[2]=0,a[3]=0,a[4]=Math.tan(c),a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},F=function(a,b,c){a[0]=b,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=c,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},G=function(a){a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},H=function(a,b){b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]},I=function(){this.data=new Float32Array(16),this.a=new Float32Array(16),this.b=new Float32Array(16),G(this.data)};I.prototype.asCSS=function(){for(var a="matrix3d(",b=0;15>b;++b)a+=Math.abs(this.data[b])<1e-4?"0,":this.data[b].toFixed(10)+",";return a+=Math.abs(this.data[15])<1e-4?"0)":this.data[15].toFixed(10)+")"},I.prototype.clear=function(){G(this.data)},I.prototype.translate=function(a,b,c){return H(this.data,this.a),A(this.b,a,b,c),J(this.a,this.b,this.data),this},I.prototype.rotateX=function(a){return H(this.data,this.a),B(this.b,a),J(this.a,this.b,this.data),this},I.prototype.rotateY=function(a){return H(this.data,this.a),C(this.b,a),J(this.a,this.b,this.data),this},I.prototype.rotateZ=function(a){return H(this.data,this.a),D(this.b,a),J(this.a,this.b,this.data),this},I.prototype.scale=function(a,b){return H(this.data,this.a),F(this.b,a,b),J(this.a,this.b,this.data),this},I.prototype.skew=function(a,b){return H(this.data,this.a),E(this.b,a,b),J(this.a,this.b,this.data),this};var J=function(a,b,c){return c[0]=a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],c[1]=a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],c[2]=a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],c[3]=a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],c[4]=a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],c[5]=a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],c[6]=a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],c[7]=a[4]*b[3]+a[5]*b[7]+a[6]*b[11]+a[7]*b[15],c[8]=a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],c[9]=a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],c[10]=a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],c[11]=a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],c[12]=a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],c[13]=a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],c[14]=a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],c[15]=a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15],c},K=function(a){this.position=M(a.position,[0,0,0]),this.rotation=M(a.rotation,[0,0,0]),this.rotationPost=M(a.rotationPost,[0,0,0]),this.skew=M(a.skew,[0,0]),this.scale=M(a.scale,[1,1]),this.opacity=a.opacity,this.width=a.width,this.height=a.height,this.matrix=new I,this.properties={opacity:void 0,width:void 0,height:void 0}};K.prototype.clone=function(){var a=new K({position:this.position.slice(0),rotation:this.rotation.slice(0),rotationPost:this.rotationPost.slice(0),skew:this.skew.slice(0),scale:this.scale.slice(0),height:this.height,width:this.width,opacity:this.opacity});return a},K.prototype.asMatrix=function(){var a=this.matrix;return a.clear(),this.transformOrigin&&a.translate(-this.transformOrigin[0],-this.transformOrigin[1],-this.transformOrigin[2]),(1!==this.scale[0]||1!==this.scale[1])&&a.scale(this.scale[0],this.scale[1]),(0!==this.skew[0]||0!==this.skew[1])&&a.skew(this.skew[0],this.skew[1]),(0!==this.rotation[0]||0!==this.rotation[1]||0!==this.rotation[2])&&(a.rotateX(this.rotation[0]),a.rotateY(this.rotation[1]),a.rotateZ(this.rotation[2])),(0!==this.position[0]||0!==this.position[1]||0!==this.position[2])&&a.translate(this.position[0],this.position[1],this.position[2]),(0!==this.rotationPost[0]||0!==this.rotationPost[1]||0!==this.rotationPost[2])&&(a.rotateX(this.rotationPost[0]),a.rotateY(this.rotationPost[1]),a.rotateZ(this.rotationPost[2])),this.transformOrigin&&a.translate(this.transformOrigin[0],this.transformOrigin[1],this.transformOrigin[2]),a},K.prototype.getProperties=function(){return this.properties.opacity=this.opacity,this.properties.width=this.width+"px",this.properties.height=this.height+"px",this.properties},StateTweener=function(a,b,c){this.start=a,this.end=b,this.result=c},StateTweener.prototype.tween=function(a){var b=this.end.position[0]-this.start.position[0],c=this.end.position[1]-this.start.position[1],d=this.end.position[2]-this.start.position[2],e=this.end.rotation[0]-this.start.rotation[0],f=this.end.rotation[1]-this.start.rotation[1],g=this.end.rotation[2]-this.start.rotation[2],h=this.end.rotationPost[0]-this.start.rotationPost[0],i=this.end.rotationPost[1]-this.start.rotationPost[1],j=this.end.rotationPost[2]-this.start.rotationPost[2],k=this.end.scale[0]-this.start.scale[0],l=this.end.scale[1]-this.start.scale[1],m=this.end.skew[0]-this.start.skew[0],n=this.end.skew[1]-this.start.skew[1],o=this.end.width-this.start.width,p=this.end.height-this.start.height,q=this.end.opacity-this.start.opacity;this.result.position[0]=this.start.position[0]+a*b,this.result.position[1]=this.start.position[1]+a*c,this.result.position[2]=this.start.position[2]+a*d,this.result.rotation[0]=this.start.rotation[0]+a*e,this.result.rotation[1]=this.start.rotation[1]+a*f,this.result.rotation[2]=this.start.rotation[2]+a*g,this.result.rotationPost[0]=this.start.rotationPost[0]+a*h,this.result.rotationPost[1]=this.start.rotationPost[1]+a*i,this.result.rotationPost[2]=this.start.rotationPost[2]+a*j,this.result.skew[0]=this.start.skew[0]+a*m,this.result.skew[1]=this.start.skew[1]+a*n,this.result.scale[0]=this.start.scale[0]+a*k,this.result.scale[1]=this.start.scale[1]+a*l,void 0!==this.end.width&&(this.result.width=this.start.width+a*o),void 0!==this.end.height&&(this.result.height=this.start.height+a*p),void 0!==this.end.opacity&&(this.result.opacity=this.start.opacity+a*q)},StateTweener.prototype.asMatrix=function(){return this.result.asMatrix()},StateTweener.prototype.getProperties=function(){return this.result.getProperties()},StateTweener.prototype.setReverse=function(){var a=this.start;this.start=this.end,this.end=a};var L=function(a,b,c,d){this.currentMatrix=a(0,new I),this.valueFeeder=a,this.start=b,this.end=c,this.result=d};L.prototype.tween=function(a){this.reverse&&(a=1-a),this.currentMatrix.clear(),this.currentMatrix=this.valueFeeder(a,this.currentMatrix);var b=this.end.width-this.start.width,c=this.end.height-this.start.height,d=this.end.opacity-this.start.opacity;void 0!==this.end.width&&(this.result.width=this.start.width+a*b),void 0!==this.end.height&&(this.result.height=this.start.height+a*c),void 0!==this.end.opacity&&(this.result.opacity=this.start.opacity+a*d)},L.prototype.asMatrix=function(){return this.currentMatrix},L.prototype.getProperties=function(){return this.result.getProperties()},L.prototype.setReverse=function(){this.reverse=!0};var M=function(a,b){return"undefined"==typeof a?b:a},N=function(a,b,c){var d="";c&&(d="perspective("+c+"px) ");var e=b.asCSS();a.style.webkitTransform=d+e,a.style.transform=d+e},O=function(a,b){for(var c in b)a.style[c]=b[c]},P=function(a){return"function"==typeof a},Q=function(a){if(!a)return a;var b={};for(var c in a)b[c]=a[c];return b};return window.jQuery&&!function(a){a.fn.snabbt=function(a,b){return snabbt(this.get(),a,b)}}(jQuery),snabbt.Matrix=I,snabbt.setElementTransform=N,snabbt});