<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <title>Sticks</title>
  <script src="randomColor.js"></script>
  <script src="dist/snabbt.min.js"></script>
  <style>
    body {
      -webkit-perspective: 2000px;
    }
    #container {
      position: absolute;
    }
    .stick {
      position: absolute;
      width: 50px;
      height: 5px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div id="container">
  </div>

  <script type="text/javascript">
    var c = document.getElementById('container');
    c.style.top = window.innerHeight/2 + 'px';
    c.style.left = (window.innerWidth/2 - 50) + 'px';

    var stick_count = 100;
    function animate(index) {
      if(index != stick_count - 1)
        return;

      for(var i=0;i<stick_count;++i) {
        var stick = document.getElementById('s' + i);
        snabbt(stick, {
          pos: [200, 0, 0],
          duration: 500,
          easing: 'cos',
        }).then({
          pos: [200, 0, 0],
          rot_post: [0, 0, (i/stick_count)*2*Math.PI],// + Math.PI],
          duration: 1000,
          easing: 'cos',
        }).then({
          from_pos: [
            200*Math.cos((i/stick_count)*2*Math.PI),
            -200*Math.sin((i/stick_count)*2*Math.PI),
            0
          ],
          pos: [
            100*Math.cos((i/stick_count)*2*Math.PI),
            -100*Math.sin((i/stick_count)*2*Math.PI),
            0
          ],
          from_rot: [0, 0, (i/stick_count)*2*Math.PI - 2*Math.PI],
          rot: [0, 0, (i/stick_count)*2*Math.PI - 2*Math.PI],
          from_rot_post: [-2*Math.PI, 0, 0],
          rot_post: [0, 0, 0],
          delay: i*10,
          duration: 2000,
          easing: 'sinc_wobbler',
        }).then({
          from_pos: [100, 0, 0],
          from_rot: [0, 0, 0],
          from_rot_post: [0, 0, (i/stick_count)*2*Math.PI],// + Math.PI],
          rot_post: [0, 0, 0],
          easing: 'cos',
          delay: stick_count*10 + i*10,
          duration: 1000,
          callback: (function(j) { return function() { animate(j) } })(i),
        });
      }
    }
    var colors = randomColor({
      count: 7,
      luminosity: 'dark',
      format: 'rgb'
    });

    for(var i=0;i<stick_count;++i) {
      var stick = document.createElement('div');
      stick.className = 'stick';
      stick.style.background = colors[i%colors.length];
      stick.id = 's' + i;
      c.appendChild(stick);
    }
    animate(stick_count - 1);
  </script>
</body>
</html>

